# DirectMemoryStrategy åŸºå‡†æµ‹è¯•è„šæœ¬

## ğŸ“ æ–‡ä»¶ç»“æ„

```
benchmark-scripts/
â”œâ”€â”€ README.md                 # æœ¬æ–‡æ¡£
â”œâ”€â”€ run-benchmark.sh         # ä¸»è¦åŸºå‡†æµ‹è¯•è„šæœ¬ï¼ˆGradleç‰ˆï¼‰
â””â”€â”€ test-strategies.sh       # å¿«é€ŸåŠŸèƒ½éªŒè¯è„šæœ¬
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŠŸèƒ½éªŒè¯ï¼ˆ30ç§’ï¼‰
```bash
# å¿«é€ŸéªŒè¯4ç§ç­–ç•¥æ˜¯å¦æ­£å¸¸å·¥ä½œ
./benchmark-scripts/test-strategies.sh
```

### 2. å¿«é€Ÿæ€§èƒ½æµ‹è¯•ï¼ˆ1-2åˆ†é’Ÿï¼‰
```bash
# è¿è¡Œç®€åŒ–çš„æ€§èƒ½å¯¹æ¯”ï¼ŒéªŒè¯æ€§èƒ½å·®å¼‚
./benchmark-scripts/run-benchmark.sh quick
```

### 3. ç‰¹å®šåœºæ™¯æµ‹è¯•ï¼ˆ2-5åˆ†é’Ÿï¼‰
```bash
# é€‰æ‹©ç‰¹å®šåœºæ™¯è¿›è¡Œæ·±å…¥æµ‹è¯•
./benchmark-scripts/run-benchmark.sh specific
```

### 4. å®Œæ•´åŸºå‡†æµ‹è¯•ï¼ˆ15-25åˆ†é’Ÿï¼‰
```bash
# è¿è¡Œå…¨é¢çš„æ€§èƒ½åŸºå‡†æµ‹è¯•
./benchmark-scripts/run-benchmark.sh
```

## ğŸ¯ æµ‹è¯•åœºæ™¯è¯´æ˜

### å¿«é€Ÿæµ‹è¯• (QuickBenchmark)
- **é…ç½®**: 1æ¬¡é¢„çƒ­ï¼Œ2æ¬¡æµ‹é‡ï¼Œæ¯æ¬¡2ç§’
- **åœºæ™¯**: å•çº¿ç¨‹å†™å…¥ + 4çº¿ç¨‹å¹¶å‘å†™å…¥
- **ç›®çš„**: å¿«é€ŸéªŒè¯ç­–ç•¥é—´çš„æ€§èƒ½å·®å¼‚
- **è€—æ—¶**: çº¦1-2åˆ†é’Ÿ

### å®Œæ•´æµ‹è¯• (DirectMemoryStrategyBenchmark)
- **é…ç½®**: 2æ¬¡é¢„çƒ­ï¼Œ3æ¬¡æµ‹é‡ï¼Œæ¯æ¬¡5ç§’
- **åœºæ™¯**: 7ç§æµ‹è¯•åœºæ™¯å…¨è¦†ç›–
- **ç›®çš„**: è¯¦ç»†çš„æ€§èƒ½åˆ†æå’Œå¯¹æ¯”
- **è€—æ—¶**: çº¦15-25åˆ†é’Ÿ

## ğŸ“Š æµ‹è¯•åœºæ™¯è¯¦è§£

| åœºæ™¯ | æè¿° | çº¿ç¨‹æ•° | å…³é”®æŒ‡æ ‡ |
|------|------|--------|----------|
| **singleThreadWrite** | å•çº¿ç¨‹å†™å…¥åŸºç¡€æ€§èƒ½ | 1 | å»¶è¿Ÿã€ååé‡ |
| **multiThreadWrite** | å¤šçº¿ç¨‹å†™å…¥å¹¶å‘æ€§èƒ½ | 8 | æ‰©å±•æ€§ã€é”ç«äº‰ |
| **singleThreadRead** | å•çº¿ç¨‹è¯»å–æ€§èƒ½ | 1 | è¯»å–å»¶è¿Ÿ |
| **multiThreadRead** | å¤šçº¿ç¨‹è¯»å–å¹¶å‘æ€§èƒ½ | 8 | è¯»å–æ‰©å±•æ€§ |
| **mixedReadWrite** | æ··åˆè¯»å†™ï¼ˆ7è¯»:3å†™ï¼‰ | 8 | å®é™…åœºæ™¯æ€§èƒ½ |
| **batchWrite** | æ‰¹é‡å†™å…¥ä¼˜åŒ– | 1 | æ‰¹å¤„ç†æ•ˆç‡ |
| **ringBuffer** | ç¯å½¢ç¼“å†²åŒºï¼ˆHFTç‰¹æ€§ï¼‰ | 4 | å†…å­˜é‡ç”¨æ•ˆç‡ |

## ğŸ”§ Gradleå‘½ä»¤å‚æ•°è¯´æ˜

è„šæœ¬ä½¿ç”¨çš„ä¸»è¦Gradle JMHå‚æ•°ï¼š

```bash
./gradlew jmh \
    --include="*TestPattern*"           # åŒ…å«çš„æµ‹è¯•æ¨¡å¼
    --jvm-args="-Xmx2g -Xms2g"         # JVMå†…å­˜è®¾ç½®
    --warmup-iterations=1               # é¢„çƒ­è½®æ•°
    --measurement-iterations=2          # æµ‹é‡è½®æ•°  
    --forks=1                          # JVMè¿›ç¨‹æ•°
    --threads=1,4                      # çº¿ç¨‹é…ç½®
    --result-format=JSON               # ç»“æœæ ¼å¼
    --result="results.json"            # ç»“æœæ–‡ä»¶
```

## ğŸ“ˆ ç»“æœè§£è¯»

### ååé‡æ¨¡å¼ (Throughput)
- **å•ä½**: ops/secï¼ˆæ¯ç§’æ“ä½œæ•°ï¼‰
- **å«ä¹‰**: æ•°å­—è¶Šå¤§æ€§èƒ½è¶Šå¥½
- **å…³æ³¨**: é«˜å¹¶å‘åœºæ™¯ä¸‹çš„å¤„ç†èƒ½åŠ›

### å¹³å‡å»¶è¿Ÿæ¨¡å¼ (AverageTime)
- **å•ä½**: ns/opï¼ˆæ¯æ¬¡æ“ä½œçº³ç§’æ•°ï¼‰
- **å«ä¹‰**: æ•°å­—è¶Šå°æ€§èƒ½è¶Šå¥½
- **å…³æ³¨**: å•æ¬¡æ“ä½œçš„å“åº”æ—¶é—´

## ğŸ¯ é¢„æœŸæ€§èƒ½è¡¨ç°

| åœºæ™¯ | Synchronized | CAS | ReadWriteLock | SegmentedLock |
|------|-------------|-----|---------------|---------------|
| **å•çº¿ç¨‹å†™å…¥** | â­â­â­ | â­â­â­â­ | â­â­ | â­â­ |
| **å¤šçº¿ç¨‹å†™å…¥** | â­ | â­â­â­ | â­â­ | â­â­â­â­ |
| **å¤šçº¿ç¨‹è¯»å–** | â­ | â­â­â­ | â­â­â­â­ | â­â­ |
| **æ··åˆè¯»å†™** | â­â­ | â­â­â­ | â­â­â­â­ | â­â­â­ |

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ‰¾ä¸åˆ°gradlew**
   ```bash
   # ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
   cd /path/to/memory-optimization
   ./benchmark-scripts/run-benchmark.sh quick
   ```

2. **å†…å­˜ä¸è¶³**
   ```bash
   # å‡å°‘JVMå†…å­˜é…ç½®
   # ç¼–è¾‘è„šæœ¬ä¸­çš„ -Xmx2g -Xms2g ä¸ºæ›´å°å€¼
   ```

3. **æµ‹è¯•è¶…æ—¶**
   ```bash
   # ä½¿ç”¨å¿«é€Ÿæµ‹è¯•æ›¿ä»£å®Œæ•´æµ‹è¯•
   ./benchmark-scripts/run-benchmark.sh quick
   ```

4. **ç¼–è¯‘é”™è¯¯**
   ```bash
   # æ¸…ç†å¹¶é‡æ–°ç¼–è¯‘
   ./gradlew clean build
   ```

### æ€§èƒ½è°ƒä¼˜å»ºè®®

1. **JVMå‚æ•°ä¼˜åŒ–**
   ```bash
   # ä½å»¶è¿ŸGC
   -XX:+UseG1GC -XX:MaxGCPauseMillis=10
   
   # ZGCï¼ˆJava 11+ï¼‰
   -XX:+UnlockExperimentalVMOptions -XX:+UseZGC
   ```

2. **ç³»ç»Ÿè°ƒä¼˜**
   ```bash
   # CPUç»‘å®š
   taskset -c 0-3 ./run-benchmark.sh quick
   
   # ç¦ç”¨CPUé¢‘ç‡è°ƒèŠ‚
   sudo cpupower frequency-set --governor performance
   ```

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [PERFORMANCE_ANALYSIS.md](../PERFORMANCE_ANALYSIS.md) - è¯¦ç»†æ€§èƒ½åˆ†ææŠ¥å‘Š
- [STRATEGY_IMPLEMENTATION_SUMMARY.md](../STRATEGY_IMPLEMENTATION_SUMMARY.md) - å®ç°æ€»ç»“
- [TODO.md](../TODO.md) - é¡¹ç›®å¼€å‘è®¡åˆ’

## ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **å¼€å‘é˜¶æ®µ**: ä½¿ç”¨ `test-strategies.sh` éªŒè¯åŠŸèƒ½
2. **æ€§èƒ½éªŒè¯**: ä½¿ç”¨ `run-benchmark.sh quick` å¿«é€Ÿå¯¹æ¯”
3. **æ·±å…¥åˆ†æ**: ä½¿ç”¨ `run-benchmark.sh specific` é’ˆå¯¹æ€§æµ‹è¯•
4. **å®Œæ•´è¯„ä¼°**: ä½¿ç”¨ `run-benchmark.sh` å…¨é¢åŸºå‡†æµ‹è¯•
5. **æŒç»­é›†æˆ**: åœ¨CI/CDä¸­é›†æˆå¿«é€Ÿæµ‹è¯•ç¡®ä¿æ€§èƒ½å›å½’